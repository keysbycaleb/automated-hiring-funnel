rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    match /users/{userId} {
      // This allows a user to read their own top-level profile data.
      allow read, write: if request.auth.uid == userId;

      // This allows a user to manage their own questionnaire sections.
      match /sections/{sectionId} {
        allow read, write: if request.auth.uid == userId;
      }

      // This allows a user to manage their own questionnaire questions.
      match /questionnaire/{questionId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // This is the rule that needs to be fixed.
      match /applicants/{applicantId} {
        // This allows anyone to submit an application.
        allow create: if true;
        
        // UPDATED: This allows the user who owns the account
        // to READ the list of applicants who have applied to them.
        allow read: if request.auth.uid == userId;
      }
    }

    // This top-level rule is no longer needed since we are not using
    // a global 'applicants' collection anymore. Removing it for clarity.
    // match /applicants/{applicantId} { ... }
  }
}
